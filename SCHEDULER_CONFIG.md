# ðŸ“… è°ƒåº¦å™¨é…ç½®è¯´æ˜Ž

## âœ… å·²éªŒè¯çš„åŠŸèƒ½

### 1ï¸âƒ£ æ¯20åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡è´¦æˆ·
- **é…ç½®**: CronTab è¡¨è¾¾å¼ `*/20 * * * *`
- **æ‰§è¡Œ**: 0åˆ†ã€20åˆ†ã€40åˆ†æ—¶æ£€æŸ¥æ‰€æœ‰è´¦æˆ·
- **ä¾‹å¦‚**: 7:00, 7:20, 7:40, 8:00, ... ä¾æ¬¡æ‰§è¡Œ

### 2ï¸âƒ£ åªåœ¨ç›´æ’­æ—¶æ‰æˆªå›¾å’Œä¸Šä¼ 
```javascript
if (res.live && res.buffer) {
  // âœ… è´¦æˆ·åœ¨ç›´æ’­ â†’ æˆªå›¾å¹¶ä¸Šä¼ åˆ° Supabase
  uploadToStorage() 
  insertToDatabase() 
} else {
  // âŒ è´¦æˆ·ä¸ç›´æ’­ â†’ ä¸åšä»»ä½•æ“ä½œï¼Œåªè®°å½•çŠ¶æ€
  logSchedulerTask(status: 'not_live')
}
```

**è¡Œä¸ºè¯´æ˜Ž:**
- âœ… ç›´æ’­ä¸­ â†’ æˆªå›¾ã€ä¸Šä¼ åˆ°å­˜å‚¨ã€æ’å…¥æ•°æ®åº“ã€æ˜¾ç¤ºåœ¨ç½‘é¡µ
- âŒ ä¸ç›´æ’­ â†’ è·³è¿‡ï¼Œä¸ä¸Šä¼ ä»»ä½•æ•°æ®

### 3ï¸âƒ£ æ—¶é—´é™åˆ¶ï¼ˆå‡Œæ™¨ä¼‘æ¯ï¼‰
```javascript
const hour = new Date().getHours();

if (hour >= 2 && hour < 7) {
  // ðŸ›Œ å‡Œæ™¨ 2:00-7:00 ç¡çœ  - ä¸æ£€æŸ¥ï¼Œä¸æˆªå›¾
  logger.info('Sleeping time (02:00-07:00). No checks until 7:00');
  return;
}

// å·¥ä½œæ—¶é—´ 7:00-æ¬¡æ—¥ 2:00 - ç»§ç»­æ­£å¸¸æ£€æŸ¥
```

**æ—¶é—´è¡¨:**
| æ—¶é—´æ®µ        | çŠ¶æ€       | è¯´æ˜Ž |
|--------------|-----------|------|
| 07:00-02:00  | ðŸŸ¢ æ´»è·ƒ   | æ¯20åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ |
| 02:00-07:00  | ðŸ”´ ç¡çœ    | ä¸è¿›è¡Œä»»ä½•æ£€æŸ¥ |

## ðŸ“Š å½“å‰ç›‘æŽ§è´¦æˆ·

```
1. yanyangtian.net
2. yanyangtian_mosquito.net  
3. unknown
4. fdm.net
```

## ðŸ”„ å·¥ä½œæµç¨‹

```
æ¯20åˆ†é’Ÿ (00:00, 20:00, 40:00 åˆ†é’Ÿ)
    â†“
æ£€æŸ¥æ—¶é—´æ˜¯å¦åœ¨ 7:00-2:00?
    â”œâ”€ å¦ (02:00-07:00) â†’ ç¡çœ , è¿”å›ž
    â””â”€ æ˜¯ â†’ ç»§ç»­
    â†“
èŽ·å–æ‰€æœ‰è´¦æˆ·åˆ—è¡¨
    â†“
å¯¹æ¯ä¸ªè´¦æˆ·:
    â”œâ”€ æ£€æŸ¥æ˜¯å¦åœ¨ç›´æ’­?
    â”‚   â”œâ”€ æ˜¯ â†’ æˆªå›¾
    â”‚   â”‚   â”œâ”€ ä¸Šä¼ åˆ° Supabase Storage
    â”‚   â”‚   â”œâ”€ ä¿å­˜å…ƒæ•°æ®åˆ°æ•°æ®åº“
    â”‚   â”‚   â””â”€ æ˜¾ç¤ºåœ¨ç½‘é¡µ âœ…
    â”‚   â””â”€ å¦ â†’ è®°å½• 'not_live' çŠ¶æ€, ä¸ä¸Šä¼  âŒ
    â”‚
    â””â”€ ç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸ
```

## ðŸŽ¯ å…³é”®ç‰¹æ€§

- âœ… **ä»…ç›´æ’­æ—¶ä¸Šä¼ **: ä¸ç›´æ’­çš„è´¦æˆ·ä¸ä¼šäº§ç”Ÿæ— æ•ˆçš„æˆªå›¾
- âœ… **çœç”µæ¨¡å¼**: å‡Œæ™¨è‡ªåŠ¨ç¡çœ ï¼ŒèŠ‚çœèµ„æº
- âœ… **å¹¶å‘å¤„ç†**: åŒæ—¶æ£€æŸ¥å¤šä¸ªè´¦æˆ· (æœ€å¤š2ä¸ªå¹¶å‘)
- âœ… **æœ‰å¤´æµè§ˆå™¨**: ä½¿ç”¨ GPU åŠ é€Ÿæ”¯æŒ WebRTC ç›´æ’­æµ
- âœ… **è‡ªåŠ¨é‡è¯•**: å¤±è´¥æ—¶æœ‰é‡è¯•æœºåˆ¶

## ðŸ” éªŒè¯æ–¹å¼

è¿è¡ŒéªŒè¯è„šæœ¬æŸ¥çœ‹å®žæ—¶çŠ¶æ€:
```bash
node scheduler-status.js
```

## ðŸ“ æ—¥å¿—æŸ¥çœ‹

å®žæ—¶æ—¥å¿—è¾“å‡ºï¼ˆterminalï¼‰:
```bash
npm start
# æˆ–åœ¨è¿è¡Œä¸­çš„ terminal ä¸­æŸ¥çœ‹
```

æ—¥å¿—ä¼šæ˜¾ç¤º:
- æ£€æŸ¥æ—¶é—´å’Œè´¦æˆ·
- æ˜¯å¦ç›´æ’­
- æ˜¯å¦ä¸Šä¼ æˆåŠŸ
- æ‰§è¡Œæ—¶é—´
